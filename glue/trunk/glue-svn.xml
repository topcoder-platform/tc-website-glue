<project name="glue-svn" 
         xmlns:ivy="antlib:org.apache.ivy.ant" basedir=".">

    <property name="root.dir" location="${basedir}/.." />
    <property name="glue.dir" location="${root.dir}/glue" />
	
	<property name="svn.url.root" value="https://coder.topcoder.com/internal"/>
	<property file="${glue.dir}/glue-projects.properties" prefix="glue.project"/>
		
	<import file="${glue.dir}/glue-base.xml"/>
    
	<target name="init" depends="glue-base.init" unless="svn-init">
	   <taskdef resource="net/sf/antcontrib/antcontrib.properties" classpathref="glue.lib.path"/>
	   <taskdef name="svn" classname="org.tigris.subversion.svnant.SvnTask" classpathref="glue.lib.path"/>
	   <property name="svn-init" value="true"/>
	</target>
	
	<!-- - - - - - - - - - - - - - - - - -
              target: checkout
             - - - - - - - - - - - - - - - - - -->
    <target name="checkout" depends="glue-svn.init" description="checkouts dependencies">
        <copyproperty dest="project.path.var" src="glue.project.${project}"/>
    	<svn>
    	    <checkout url="${svn.url.root}/${project.path.var}/trunk" destPath="${root.dir}/${project.path.var}" />
        </svn>
    </target>
    
    <target name="update" depends="glue-svn.init" description="--> update current project">
        <echo>Test</echo>
        <copyproperty dest="project.path.var" src="glue.project.${ant.project.name}"/>
        <svn>
            <update dir="${root.dir}/${project.path.var}" />
        </svn>
    </target>
	
    <target name="tag" depends="glue-svn.init" description="--> tag current project">
        <copyproperty dest="project.path.var" src="glue.project.${ant.project.name}"/>
        <svn>
            <copy srcUrl="${svn.url.root}/${project.path.var}/trunk" destUrl="${svn.url.root}/${project.path.var}/tags/${ant.project.name}-${app.version}" message="new version tag ${app.version}"/>
        </svn>
    </target>
	
   
    <target name="update-all" depends="glue-svn.init" description="--> update current project and its dependencies">
        <recurse target="update" />
    </target>

	<target name="extract-svn-version" depends="glue-svn.init" unless="app.version">
		<svn>
			<info target="${basedir}"/>
		</svn>
		<propertyregex property="app.version"
		              input="${svn.info.url}"
              		      regexp="(.*)\-([0-9].*)"
			      replace="\2"
		              casesensitive="false" />
		<echo>VERSION: ${app.version}</echo>
	</target>
	
	<target name="version" depends="init,extract-svn-version,glue-base.version" unless="ivy.new.revision" if="use.svn.version"/>
</project>
